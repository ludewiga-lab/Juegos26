<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Space War Z</title>
    <style>
        :root {
            --neon-green: #39ff14;
            --neon-purple: #bc13fe;
            --neon-blue: #00d9ff;
            /* Safe Areas para evitar barras de Android/iOS */
            --safe-bottom: env(safe-area-inset-bottom, 15px);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background: #050505;
            color: #fff;
            font-family: 'system-ui', sans-serif;
            overflow: hidden;
            touch-action: none;
            display: flex;
            flex-direction: column;
            height: 100vh; /* Altura total real */
        }

        /* Contenedor UI Superior */
        #header-ui {
            padding-top: env(safe-area-inset-top, 10px);
            height: 80px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: linear-gradient(to bottom, #111, transparent);
            z-index: 10;
        }

        .stat-box { text-align: center; }
        .stat-label { font-size: 10px; color: var(--neon-blue); text-transform: uppercase; }
        .stat-value { font-size: 18px; font-weight: bold; display: block; }

        /* √Årea de Juego: Ocupa el resto del espacio menos los controles */
        #game-wrapper {
            flex-grow: 1;
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Panel de Controles: Aqu√≠ est√° el truco */
        .controls-panel {
            background: linear-gradient(to top, #000 70%, transparent);
            padding-bottom: calc(var(--safe-bottom) + 15px); /* Empuja hacia arriba */
            padding-top: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 20;
            min-height: 120px; /* Asegura espacio para los botones */
        }

        .btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.1);
            transition: transform 0.1s, background 0.1s;
        }

        .btn:active {
            transform: scale(1.1);
            background: rgba(0, 217, 255, 0.3);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        #btn-fire {
            width: 85px;
            height: 85px;
            border-color: #ff3c00;
            color: #ff3c00;
            font-size: 35px;
        }

        #btn-fire:active {
            background: rgba(255, 60, 0, 0.3);
            box-shadow: 0 0 25px #ff3c00;
        }

        #health-bar-container {
            width: 80px;
            height: 10px;
            background: #222;
            border-radius: 5px;
            border: 1px solid #444;
            overflow: hidden;
        }
        #health-inner {
            width: 100%;
            height: 100%;
            background: var(--neon-green);
            transition: width 0.3s;
        }
    </style>
</head>
<body>

    <div id="header-ui">
        <div class="stat-box">
            <span class="stat-label">Puntos</span>
            <span id="score" class="stat-value">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">Escudo</span>
            <div id="health-bar-container"><div id="health-inner"></div></div>
        </div>
        <div class="stat-box">
            <span class="stat-label">R√©cord</span>
            <span id="best" class="stat-value">0</span>
        </div>
    </div>

    <div id="game-wrapper">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="controls-panel">
        <div id="btn-left" class="btn">‚óÄ</div>
        <div id="btn-fire" class="btn">üî•</div>
        <div id="btn-right" class="btn">‚ñ∂</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const bestEl = document.getElementById('best');
        const healthEl = document.getElementById('health-inner');

        let width, height;
        let score = 0;
        let highscore = localStorage.getItem('space_war_z_best') || 0;
        let health = 100;
        let isGameOver = false;

        bestEl.innerText = highscore;

        // Ajuste din√°mico del Canvas al contenedor
        function resize() {
            const wrapper = document.getElementById('game-wrapper');
            width = wrapper.clientWidth;
            height = wrapper.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        // Entidades
        const player = { x: 0, y: 0, w: 40, h: 40, speed: 6, movingLeft: false, movingRight: false };
        let bullets = [], enemies = [], stars = [];

        // Inicializar Jugador
        player.x = width / 2 - 20;
        player.y = height - 70;

        // Estrellas
        for(let i=0; i<50; i++) stars.push({x: Math.random()*2000, y: Math.random()*2000, s: Math.random()*2+1});

        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x + 20, player.y + 20);
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#00d9ff';
            ctx.fillStyle = '#00d9ff';
            ctx.beginPath();
            ctx.moveTo(0, -20);
            ctx.lineTo(20, 15);
            ctx.lineTo(0, 5);
            ctx.lineTo(-20, 15);
            ctx.closePath();
            ctx.fill();
            ctx.restore();
        }

        function spawnEnemy() {
            if(Math.random() < 0.03) {
                enemies.push({
                    x: Math.random() * (width - 40),
                    y: -50,
                    speed: 2 + Math.random() * 3,
                    w: 35, h: 35
                });
            }
        }

        function update() {
            if(isGameOver) return;

            // Movimiento
            if(player.movingLeft && player.x > 0) player.x -= player.speed;
            if(player.movingRight && player.x < width - 40) player.x += player.speed;

            // Balas
            bullets.forEach((b, i) => {
                b.y -= 10;
                if(b.y < -20) bullets.splice(i, 1);
            });

            // Enemigos
            enemies.forEach((en, i) => {
                en.y += en.speed;
                // Colisi√≥n con bala
                bullets.forEach((b, bi) => {
                    if(b.x > en.x && b.x < en.x + en.w && b.y < en.y + en.h) {
                        enemies.splice(i, 1);
                        bullets.splice(bi, 1);
                        score += 10;
                        scoreEl.innerText = score;
                    }
                });
                // Colisi√≥n con jugador
                if(en.y + en.h > player.y && en.x < player.x + 40 && en.x + en.w > player.x) {
                    enemies.splice(i, 1);
                    health -= 20;
                    healthEl.style.width = health + "%";
                    if(health <= 0) endGame();
                }
                if(en.y > height) enemies.splice(i, 1);
            });

            spawnEnemy();
        }

        function draw() {
            ctx.fillStyle = '#050505';
            ctx.fillRect(0, 0, width, height);

            // Estrellas
            ctx.fillStyle = '#fff';
            stars.forEach(s => {
                s.y += s.s;
                if(s.y > height) s.y = 0;
                ctx.fillRect(s.x % width, s.y, 1, 1);
            });

            drawPlayer();

            ctx.fillStyle = '#ff3c00';
            bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 15));

            ctx.fillStyle = '#bc13fe';
            enemies.forEach(en => {
                ctx.fillRect(en.x, en.y, en.w, en.h);
            });

            update();
            requestAnimationFrame(draw);
        }

        function endGame() {
            isGameOver = true;
            if(score > highscore) localStorage.setItem('space_war_z_best', score);
            alert("GAME OVER - Puntos: " + score);
            location.reload();
        }

        // --- CONTROLES T√ÅCTILES MEJORADOS ---
        const setupBtn = (id, startFn, endFn) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); startFn(); });
            el.addEventListener('touchend', (e) => { e.preventDefault(); endFn(); });
        };

        setupBtn('btn-left', () => player.movingLeft = true, () => player.movingLeft = false);
        setupBtn('btn-right', () => player.movingRight = true, () => player.movingRight = false);
        document.getElementById('btn-fire').addEventListener('touchstart', (e) => {
            e.preventDefault();
            bullets.push({x: player.x + 18, y: player.y});
        });

        draw();
    </script>
</body>
</html>
