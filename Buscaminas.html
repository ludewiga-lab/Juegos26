<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Minesweeper Neon Pro</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --glass: rgba(30, 41, 59, 0.7);
            --accent: #38bdf8;
            --mine: #f43f5e;
            --safe: #10b981;
            --cell-flat: #334155;
            --cell-raised: #475569;
            --text-main: #f8fafc;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            padding: env(safe-area-inset-top) 0 var(--safe-bottom) 0;
            background: radial-gradient(circle at top, #1e293b, var(--bg-dark));
            color: var(--text-main);
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* HEADER & STATS */
        .game-header {
            width: 95vw;
            padding: 20px 0;
            text-align: center;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            width: 95vw;
            max-width: 500px;
            background: var(--glass);
            padding: 15px 25px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .stat-item { text-align: center; }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; opacity: 0.6; display: block; }
        .stat-value { font-size: 1.4rem; font-weight: 800; font-variant-numeric: tabular-nums; }

        /* MODO SELECTOR */
        .mode-toggle {
            display: flex;
            background: var(--glass);
            padding: 5px;
            border-radius: 100px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .mode-btn {
            padding: 10px 20px;
            border-radius: 100px;
            border: none;
            background: transparent;
            color: white;
            font-weight: 600;
            transition: 0.3s;
        }

        .mode-btn.active {
            background: var(--accent);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.4);
        }

        /* GRID DEL JUEGO */
        .game-viewport {
            width: 95vw;
            aspect-ratio: 1/1;
            max-width: 500px;
            max-height: 500px;
            background: var(--glass);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        #board {
            display: grid;
            gap: 4px;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        .cell {
            background: var(--cell-raised);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: calc(100% + 0.5vw);
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.1), 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.1s, background 0.2s;
        }

        .cell:active { transform: scale(0.92); }

        .cell.revealed {
            background: var(--cell-flat);
            box-shadow: none;
        }

        .cell.mine { background: var(--mine); animation: pulse 0.5s infinite alternate; }
        .cell.flagged { color: var(--accent); }
        
        /* Colores din√°micos para n√∫meros */
        .n1 { color: #38bdf8; } .n2 { color: #4ade80; } .n3 { color: #fbbf24; }
        .n4 { color: #f87171; } .n5 { color: #c084fc; }

        /* FOOTER CONTROLS */
        .footer-actions {
            margin-top: auto;
            padding: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding-bottom: calc(20px + var(--safe-bottom));
        }

        .btn-action {
            padding: 15px 30px;
            border-radius: 15px;
            border: none;
            background: var(--glass);
            color: white;
            font-weight: 700;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn-primary { background: var(--accent); color: var(--bg-dark); }

        @keyframes pulse {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.9); opacity: 0.8; }
        }
    </style>
</head>
<body>

    <header class="game-header">
        <h2 style="margin:0; font-weight: 900; letter-spacing: -1px;">NEON MINES</h2>
    </header>

    <div class="stats-bar">
        <div class="stat-item">
            <span class="stat-label">Minas</span>
            <span id="mine-count" class="stat-value">00</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">R√©cord</span>
            <span id="high-score" class="stat-value">000</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Tiempo</span>
            <span id="timer" class="stat-value">000</span>
        </div>
    </div>

    <div class="mode-toggle">
        <button id="mode-reveal" class="mode-btn active">üîç Revelar</button>
        <button id="mode-flag" class="mode-btn">üö© Bandera</button>
    </div>

    <div class="game-viewport">
        <div id="board"></div>
    </div>

    <footer class="footer-actions">
        <button class="btn-action" onclick="changeDifficulty()">Dificultad</button>
        <button class="btn-action btn-primary" onclick="initGame()">Reiniciar</button>
    </footer>

    <script>
        let rows = 10, cols = 10, mines = 15;
        let board = [], gameOver = false, timer = 0, interval = null;
        let interactionMode = 'reveal'; // 'reveal' o 'flag'
        let revealedCells = 0;

        const boardEl = document.getElementById('board');
        const mineDisplay = document.getElementById('mine-count');
        const timerDisplay = document.getElementById('timer');
        const highScoreDisplay = document.getElementById('high-score');

        // Setup inicial
        function initGame() {
            clearInterval(interval);
            gameOver = false;
            timer = 0;
            revealedCells = 0;
            interval = null;
            timerDisplay.innerText = "000";
            highScoreDisplay.innerText = localStorage.getItem('mine_highscore') || '000';
            
            createBoard();
            updateMineCount();
        }

        function createBoard() {
            boardEl.innerHTML = '';
            boardEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            board = [];

            // Crear matriz y elementos
            for (let r = 0; r < rows; r++) {
                board[r] = [];
                for (let c = 0; c < cols; c++) {
                    const el = document.createElement('div');
                    el.classList.add('cell');
                    
                    // Soporte t√°ctil Mobile-First
                    el.addEventListener('pointerdown', (e) => startPress(r, c));
                    
                    const cell = {
                        r, c, isMine: false, revealed: false, flagged: false, count: 0, el
                    };
                    board[r][c] = cell;
                    boardEl.appendChild(el);
                }
            }

            // Plantar minas
            let planted = 0;
            while (planted < mines) {
                let r = Math.floor(Math.random() * rows);
                let c = Math.floor(Math.random() * cols);
                if (!board[r][c].isMine) {
                    board[r][c].isMine = true;
                    planted++;
                }
            }

            // Calcular n√∫meros
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (board[r][c].isMine) continue;
                    let count = 0;
                    traverseNeighbors(r, c, (nr, nc) => {
                        if (board[nr][nc].isMine) count++;
                    });
                    board[r][c].count = count;
                }
            }
        }

        // L√≥gica de interacci√≥n
        let pressTimer;
        function startPress(r, c) {
            if (gameOver) return;
            
            // Iniciar cron√≥metro al primer toque
            if (!interval) {
                interval = setInterval(() => {
                    timer++;
                    timerDisplay.innerText = String(timer).padStart(3, '0');
                }, 1000);
            }

            // L√≥gica de Pulsaci√≥n Larga (Long Press) para poner bandera sin cambiar modo
            pressTimer = setTimeout(() => {
                toggleFlag(r, c);
                pressTimer = null;
            }, 500);

            // Al soltar el dedo...
            const endPress = () => {
                clearTimeout(pressTimer);
                if (pressTimer) { // Fue un toque corto
                    if (interactionMode === 'reveal') revealCell(r, c);
                    else toggleFlag(r, c);
                }
                window.removeEventListener('pointerup', endPress);
            };
            window.addEventListener('pointerup', endPress);
        }

        function revealCell(r, c) {
            const cell = board[r][c];
            if (cell.revealed || cell.flagged || gameOver) return;

            cell.revealed = true;
            cell.el.classList.add('revealed');
            revealedCells++;

            if (cell.isMine) {
                cell.el.classList.add('mine');
                cell.el.innerText = 'üí•';
                endGame(false);
                return;
            }

            if (cell.count > 0) {
                cell.el.innerText = cell.count;
                cell.el.classList.add('n' + cell.count);
            } else {
                traverseNeighbors(r, c, (nr, nc) => revealCell(nr, nc));
            }

            if (revealedCells === (rows * cols) - mines) endGame(true);
        }

        function toggleFlag(r, c) {
            const cell = board[r][c];
            if (cell.revealed || gameOver) return;
            
            cell.flagged = !cell.flagged;
            cell.el.innerText = cell.flagged ? 'üö©' : '';
            cell.el.classList.toggle('flagged');
            updateMineCount();
            
            // Feedback h√°ptico si est√° disponible
            if (window.navigator.vibrate) window.navigator.vibrate(50);
        }

        function updateMineCount() {
            const flags = board.flat().filter(c => c.flagged).length;
            mineDisplay.innerText = String(Math.max(0, mines - flags)).padStart(2, '0');
        }

        function traverseNeighbors(r, c, callback) {
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    let nr = r + i, nc = c + j;
                    if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) callback(nr, nc);
                }
            }
        }

        function endGame(won) {
            gameOver = true;
            clearInterval(interval);
            
            if (won) {
                const currentHS = localStorage.getItem('mine_highscore') || 999;
                if (timer < currentHS) {
                    localStorage.setItem('mine_highscore', timer);
                    alert("¬°NUEVO R√âCORD! " + timer + " segundos.");
                } else {
                    alert("¬°Ganaste!");
                }
            } else {
                // Revelar todas las minas
                board.flat().forEach(c => {
                    if (c.isMine) {
                        c.el.classList.add('revealed', 'mine');
                        c.el.innerText = 'üí£';
                    }
                });
                alert("BOOM! Fin del juego.");
            }
        }

        // UI Controls
        document.getElementById('mode-reveal').onclick = function() {
            interactionMode = 'reveal';
            this.classList.add('active');
            document.getElementById('mode-flag').classList.remove('active');
        };

        document.getElementById('mode-flag').onclick = function() {
            interactionMode = 'flag';
            this.classList.add('active');
            document.getElementById('mode-reveal').classList.remove('active');
        };

        function changeDifficulty() {
            const d = prompt("Elige: 1 (F√°cil), 2 (Medio), 3 (Duro)");
            if (d == '1') { rows = 8; cols = 8; mines = 10; }
            else if (d == '2') { rows = 12; cols = 10; mines = 20; }
            else if (d == '3') { rows = 15; cols = 10; mines = 35; }
            initGame();
        }

        initGame();
    </script>
</body>
</html>
