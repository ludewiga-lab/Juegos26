<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Minesweeper Tech Pro - Mobile First</title>
    <style>
        :root {
            --bg-main: #1a252f;
            --cell-hidden: linear-gradient(145deg, #bdc3c7, #95a5a6);
            --cell-reveal: #ecf0f1;
            --gap-color: #34495e;
            --mine-hit: #e74c3c;
            --mine-reveal: #7f8c8d;
            --accent: #3498db;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-main);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: calc(10px + var(--safe-top)) 10px calc(20px + var(--safe-bottom)) 10px;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: none; /* Bloquea scroll y zoom accidental */
        }

        h1 {
            font-size: 1.2rem;
            margin: 10px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            background: var(--accent);
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 4px 0 #2980b9;
            transition: all 0.1s;
            cursor: pointer;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #2980b9;
        }

        #reset-btn { background-color: #e67e22; box-shadow: 0 4px 0 #d35400; }
        
        /* Bot√≥n de Modo Bandera */
        #mode-btn {
            background-color: #95a5a6;
            box-shadow: 0 4px 0 #7f8c8d;
            font-size: 1.1rem;
        }
        #mode-btn.active {
            background-color: #f1c40f;
            box-shadow: 0 4px 0 #f39c12;
            transform: scale(1.05);
        }

        .game-container {
            background-color: #2c3e50;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            max-width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stats {
            display: flex;
            width: 100%;
            justify-content: space-around;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
            background: #000;
            padding: 8px;
            border-radius: 6px;
            color: #e74c3c;
            border: 2px solid #444;
        }

        /* TABLERO DIN√ÅMICO */
        #board {
            display: grid;
            gap: 2px;
            background-color: var(--gap-color);
            padding: 4px;
            border-radius: 4px;
            user-select: none;
            /* Asegura que el tablero no exceda el ancho de pantalla */
            max-width: 95vw;
            overflow: auto;
        }

        .cell {
            /* Tama√±o fijo para que no cambien al seleccionar */
            width: 32px;
            height: 32px;
            background: var(--cell-hidden);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.1rem;
            cursor: pointer;
            border-radius: 2px;
            box-shadow: inset 2px 2px 0px rgba(255,255,255,0.3), inset -2px -2px 0px rgba(0,0,0,0.2);
            transition: background 0.1s;
        }

        .cell.revealed {
            background: var(--cell-reveal);
            box-shadow: none;
            border: 1px solid #bdc3c7;
        }

        .cell.mine { background-color: var(--mine-reveal); }
        .cell.hit { background-color: var(--mine-hit) !important; animation: shake 0.2s; }

        /* Colores de n√∫meros cl√°sicos */
        .n1 { color: #2980b9; } .n2 { color: #27ae60; } .n3 { color: #e74c3c; }
        .n4 { color: #8e44ad; } .n5 { color: #d35400; }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(5px); }
            50% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

    <h1>Buscaminas Tech Pro</h1>
    
    <div class="controls">
        <button onclick="initGame('easy')">F√°cil</button>
        <button onclick="initGame('medium')">Medio</button>
        <button onclick="initGame('hard')">Experto</button>
        <button id="mode-btn" onclick="toggleFlagMode()">‚õèÔ∏è</button>
        <button id="reset-btn" onclick="resetGame()">üîÑ</button>
    </div>

    <div class="game-container">
        <div class="stats">
            <div>üí£ <span id="mine-count">000</span></div>
            <div>‚è±Ô∏è <span id="timer">000</span></div>
        </div>
        <div id="board"></div>
    </div>

    <script>
        let rows, cols, minesCount, boardArray, revealedCount, gameOver, timerInterval, seconds;
        let currentLevel = 'easy';
        let flagMode = false;
        const boardElement = document.getElementById('board');

        function toggleFlagMode() {
            flagMode = !flagMode;
            document.getElementById('mode-btn').classList.toggle('active');
            document.getElementById('mode-btn').innerText = flagMode ? 'üö©' : '‚õèÔ∏è';
        }

        function initGame(level) {
            currentLevel = level;
            flagMode = false;
            document.getElementById('mode-btn').classList.remove('active');
            document.getElementById('mode-btn').innerText = '‚õèÔ∏è';

            if (level === 'easy') { rows = 8; cols = 8; minesCount = 10; }
            else if (level === 'medium') { rows = 12; cols = 10; minesCount = 20; }
            else { rows = 16; cols = 10; minesCount = 40; } // Ajustado para verticalidad m√≥vil

            clearInterval(timerInterval);
            timerInterval = null;
            seconds = 0;
            gameOver = false;
            revealedCount = 0;
            document.getElementById('timer').innerText = "000";
            document.getElementById('mine-count').innerText = String(minesCount).padStart(3, '0');
            
            createBoard();
        }

        function resetGame() { initGame(currentLevel); }

        function createBoard() {
            boardElement.innerHTML = '';
            boardElement.style.gridTemplateColumns = `repeat(${cols}, 32px)`;
            boardArray = [];

            for (let r = 0; r < rows; r++) {
                boardArray[r] = [];
                for (let c = 0; c < cols; c++) {
                    const cellObj = {
                        r, c, isMine: false, revealed: false, flagged: false, neighborMines: 0,
                        element: document.createElement('div')
                    };
                    cellObj.element.classList.add('cell');
                    
                    // Soporte para Click, Toque y Modo Bandera
                    cellObj.element.addEventListener('click', (e) => {
                        if (flagMode) toggleFlag(r, c);
                        else revealCell(r, c);
                    });

                    // Click derecho para banderas (Desktop)
                    cellObj.element.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        toggleFlag(r, c);
                    });

                    boardElement.appendChild(cellObj.element);
                    boardArray[r][c] = cellObj;
                }
            }

            // Minas aleatorias
            let placed = 0;
            while (placed < minesCount) {
                let rr = Math.floor(Math.random() * rows);
                let cc = Math.floor(Math.random() * cols);
                if (!boardArray[rr][cc].isMine) {
                    boardArray[rr][cc].isMine = true;
                    placed++;
                }
            }

            // Calcular n√∫meros
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (!boardArray[r][c].isMine) {
                        let count = 0;
                        for (let i = -1; i <= 1; i++) {
                            for (let j = -1; j <= 1; j++) {
                                let nr = r + i, nc = c + j;
                                if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && boardArray[nr][nc].isMine) count++;
                            }
                        }
                        boardArray[r][c].neighborMines = count;
                    }
                }
            }
        }

        function toggleFlag(r, c) {
            if (gameOver) return;
            const cell = boardArray[r][c];
            if (cell.revealed) return;

            cell.flagged = !cell.flagged;
            cell.element.innerText = cell.flagged ? 'üö©' : '';
            
            const currentFlags = boardArray.flat().filter(c => c.flagged).length;
            document.getElementById('mine-count').innerText = String(Math.max(0, minesCount - currentFlags)).padStart(3, '0');
        }

        function revealCell(r, c) {
            const cell = boardArray[r][c];
            if (cell.revealed || cell.flagged || gameOver) return;

            if (!timerInterval) {
                timerInterval = setInterval(() => {
                    seconds++;
                    document.getElementById('timer').innerText = String(seconds).padStart(3, '0');
                }, 1000);
            }

            cell.revealed = true;
            cell.element.classList.add('revealed');

            if (cell.isMine) {
                cell.element.classList.add('hit');
                cell.element.innerText = 'üí£';
                endGame(false);
                return;
            }

            revealedCount++;
            if (cell.neighborMines > 0) {
                cell.element.innerText = cell.neighborMines;
                cell.element.classList.add('n' + cell.neighborMines);
            } else {
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        let nr = r + i, nc = c + j;
                        if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) revealCell(nr, nc);
                    }
                }
            }

            if (revealedCount === (rows * cols) - minesCount) endGame(true);
        }

        function endGame(won) {
            gameOver = true;
            clearInterval(timerInterval);

            boardArray.flat().forEach(cell => {
                if (cell.isMine) {
                    cell.element.classList.add('revealed');
                    cell.element.innerText = 'üí£';
                }
            });

            setTimeout(() => {
                alert(won ? "üèÜ ¬°LOGRADO! √Årea despejada." : "üí• ¬°BOOM! Reint√©ntalo.");
            }, 100);
        }

        initGame('easy');
    </script>
</body>
</html>
