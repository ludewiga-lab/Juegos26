<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Beast Tug: Tablet & Mobile Pro</title>
    <style>
        :root {
            --beast-blue: #00a8ff;
            --beast-pink: #ff0055;
            --gold: #fbc531;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: 'Arial Black', sans-serif;
            background: #000;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            touch-action: none; /* Crucial para tablets */
        }

        /* Contenedor que limita el ancho en tablets */
        .game-viewport {
            width: 100%;
            max-width: 900px;
            height: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            background: #1e272e;
            position: relative;
        }

        #header {
            padding: 10px;
            text-align: center;
            background: rgba(0,0,0,0.8);
            border-bottom: 3px solid var(--beast-blue);
            z-index: 10;
        }

        #score-board { color: var(--gold); font-size: 1rem; }

        /* Escenario de la cuerda */
        .arena {
            flex: 1;
            position: relative;
            background: linear-gradient(90deg, #0f1418 0%, #2f3640 50%, #0f1418 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Líneas de meta */
        .line {
            position: absolute;
            height: 70%;
            width: 4px;
            background: white;
            opacity: 0.3;
            z-index: 1;
        }
        .left-win { left: 15%; border-left: 8px solid var(--beast-pink); }
        .right-win { right: 15%; border-right: 8px solid #4cd137; }

        /* LA CUERDA: Mejorada para tablets */
        #rope {
            position: absolute;
            width: 2000px; /* Ultra larga para que no se vea el fin */
            height: 16px;
            background: repeating-linear-gradient(90deg, #7f8c8d, #bdc3c7 20px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.05s linear;
            will-change: transform;
        }

        #marker {
            width: 40px;
            height: 40px;
            background: var(--beast-pink);
            border: 4px solid white;
            border-radius: 50%;
            box-shadow: 0 0 20px var(--beast-pink);
        }

        /* BOTONES */
        .controls {
            display: none;
            height: 25dvh;
            max-height: 180px;
        }

        .btn-tap {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: 900;
            cursor: pointer;
            user-select: none;
        }
        #btn-l { background: #c23616; border-right: 2px solid #000; }
        #btn-r { background: #44bd32; }

        /* OVERLAY */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 100; text-align: center;
        }

        .menu-btn {
            padding: 15px 30px; margin: 10px; width: 80%; max-width: 300px;
            background: var(--gold); border: none; border-radius: 12px;
            font-weight: bold; font-size: 1.1rem;
        }
    </style>
</head>
<body>

<div class="game-viewport">
    <div id="header">
        <div id="score-board">RÉCORD: <span id="high-score">0</span></div>
    </div>

    <div class="arena">
        <div class="line left-win"></div>
        <div class="line right-win"></div>
        <div id="rope">
            <div id="marker"></div>
        </div>
    </div>

    <div id="controls" class="controls">
        <div id="btn-l" class="btn-tap">TIRA</div>
        <div id="btn-r" class="btn-tap">TIRA</div>
    </div>

    <div id="overlay">
        <h1 id="msg" style="color:var(--beast-blue)">BEAST TUG</h1>
        <button class="menu-btn" onclick="init(1)" style="background:var(--beast-blue); color:white">1 JUGADOR (VS CPU)</button>
        <button class="menu-btn" onclick="init(2)">2 JUGADORES (PVP)</button>
    </div>
</div>

<script>
    let offset = 0; // 0 es el centro perfecto
    let gameActive = false;
    let mode = 1;
    let highScore = localStorage.getItem('beastTugScore') || 0;
    const rope = document.getElementById('rope');
    const controls = document.getElementById('controls');
    const overlay = document.getElementById('overlay');
    const msg = document.getElementById('msg');

    document.getElementById('high-score').innerText = highScore;

    function init(m) {
        mode = m;
        offset = 0;
        gameActive = true;
        overlay.style.display = 'none';
        controls.style.display = 'flex';
        
        if(mode === 1) {
            document.getElementById('btn-r').style.opacity = "0.3";
            document.getElementById('btn-r').innerText = "CPU";
            runCPU();
        } else {
            document.getElementById('btn-r').style.opacity = "1";
            document.getElementById('btn-r').innerText = "TIRA";
        }
        updatePosition();
    }

    function runCPU() {
        if(!gameActive || mode !== 1) return;
        // La CPU tira cada 120ms
        setTimeout(() => {
            if(gameActive) {
                offset += 8; // La fuerza de la CPU
                updatePosition();
                runCPU();
            }
        }, 120);
    }

    function pull(side) {
        if(!gameActive) return;
        if(mode === 1 && side === 'r') return;

        const strength = 15;
        if(side === 'l') offset -= strength;
        else offset += strength;
        
        updatePosition();
    }

    function updatePosition() {
        rope.style.transform = `translateX(${-offset}px)`;

        // Cálculo de límites basado en el ancho real de la pantalla
        const limit = window.innerWidth * 0.35; 

        if (offset <= -limit) endGame("¡VICTORIA!", true);
        if (offset >= limit) endGame("DERROTA", false);
    }

    function endGame(text, win) {
        gameActive = false;
        overlay.style.display = 'flex';
        msg.innerText = text;
        if(win && mode === 1) {
            // Lógica simple de score (puedes mejorarla)
            highScore++; 
            localStorage.setItem('beastTugScore', highScore);
            document.getElementById('high-score').innerText = highScore;
        }
    }

    // LISTENER MULTI-TOUCH (SOLUCIÓN TABLET)
    const handleAction = (side, e) => {
        e.preventDefault();
        pull(side);
    };

    const bl = document.getElementById('btn-l');
    const br = document.getElementById('btn-r');

    // Usamos pointerdown para máxima compatibilidad con Tablets (iPad/Android)
    bl.addEventListener('pointerdown', (e) => handleAction('l', e));
    br.addEventListener('pointerdown', (e) => handleAction('r', e));

    // Ajustar el límite si el usuario gira la tablet
    window.onresize = () => updatePosition();

</script>
</body>
</html>
