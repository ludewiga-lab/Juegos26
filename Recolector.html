<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S√∫per Recolector Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a2e; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        canvas { display: block; background: linear-gradient(to bottom, #1e3c72, #2a5298); }
        
        #ui-layer {
            position: absolute;
            top: 15px; left: 15px; right: 15px;
            display: flex; justify-content: space-between;
            color: white; font-size: 22px; font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
            display: none;
        }

        #menu-inicio {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px; border-radius: 20px;
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 80%; max-width: 300px;
            z-index: 10;
        }

        .btn-start {
            background: #27ae60; color: white; border: none;
            padding: 15px 30px; font-size: 18px; border-radius: 10px;
            cursor: pointer; margin-top: 20px; width: 100%;
        }
        
        input[type=range] { width: 100%; margin: 20px 0; }
        
        /* Animaci√≥n de sacudida para el error */
        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            50% { transform: translate(-1px, 2px) rotate(1deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            100% { transform: translate(1px, -2px) rotate(0deg); }
        }
    </style>
</head>
<body id="gameBody">

    <div id="menu-inicio">
        <h2>Ajusta la Velocidad</h2>
        <div id="speedDisplay" style="font-size: 30px; color: #2980b9; font-weight: bold;">3</div>
        <input type="range" id="speedSlider" min="1" max="10" value="3">
        <button class="btn-start" onclick="startGame()">EMPEZAR</button>
    </div>

    <div id="ui-layer">
        <div id="score">Puntos: 0</div>
        <div id="lives">Vidas: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const menu = document.getElementById("menu-inicio");
        const uiLayer = document.getElementById("ui-layer");
        const speedSlider = document.getElementById("speedSlider");
        const speedDisplay = document.getElementById("speedDisplay");
        const body = document.getElementById("gameBody");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0;
        let lives = 3;
        let baseSpeed = 3;
        let gameActive = false;
        let isPaused = false;
        let items = [];

        const basket = { 
            x: canvas.width / 2 - 45, 
            y: canvas.height - 120, 
            width: 90, 
            height: 60,
            targetX: canvas.width / 2 - 45 // Para suavizar movimiento
        };

        const itemLibrary = [
	    { symbol: "üçé", value: 10, type: "good" },
            { symbol: "üçå", value: 15, type: "good" },
            { symbol: "üíé", value: 50, type: "good" },
            { symbol: "üçâ", value: 20, type: "good" },
            { symbol: "‚≠ê", value: 100, type: "good" },
            { symbol: "üí£", value: 0, type: "bad" },
            { symbol: "üí©", value: 0, type: "bad" }
        ];

        speedSlider.oninput = () => speedDisplay.innerText = speedSlider.value;

        function startGame() {
            baseSpeed = parseInt(speedSlider.value);
            score = 0;
            lives = 3;
            items = [];
            gameActive = true;
            isPaused = false;
            menu.style.display = "none";
            uiLayer.style.display = "flex";
            updateUI();
            requestAnimationFrame(draw);
        }

        function updateUI() {
            document.getElementById("score").innerText = `Puntos: ${score}`;
            document.getElementById("lives").innerText = "Vidas: " + "‚ù§Ô∏è".repeat(lives);
        }

        // Control t√°ctil corregido (Lerp simple para suavidad)
        const handleMove = (e) => {
            if (!gameActive || isPaused) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            // Limitamos la cesta a los bordes de la pantalla
            let newX = clientX - basket.width / 2;
            if (newX < 0) newX = 0;
            if (newX > canvas.width - basket.width) newX = canvas.width - basket.width;
            basket.x = newX;
        };

        canvas.addEventListener("touchmove", (e) => { e.preventDefault(); handleMove(e); }, { passive: false });
        canvas.addEventListener("mousemove", handleMove);

        function triggerExplosion() {
            isPaused = true;
            body.classList.add("shake"); // Sacudida de pantalla
            
            // Efecto visual de explosi√≥n en el canvas
            ctx.fillStyle = "rgba(255, 87, 34, 0.5)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            setTimeout(() => {
                body.classList.remove("shake");
                isPaused = false;
            }, 800); // Pausa de 0.8 segundos
        }

        function createItem() {
            const isGood = Math.random() > 0.3;
            const pool = isGood ? itemLibrary.filter(i => i.type === "good") : itemLibrary.filter(i => i.type === "bad");
            const template = pool[Math.floor(Math.random() * pool.length)];

            items.push({
                x: Math.random() * (canvas.width - 50),
                y: -50,
                size: 45,
                speed: baseSpeed + (Math.random() * 2),
                ...template
            });
        }

        function draw() {
            if (!gameActive) return;

            if (!isPaused) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Dibujar Cesta
                ctx.fillStyle = "#8b4513";
                ctx.beginPath();
                ctx.roundRect(basket.x, basket.y, basket.width, basket.height, [0, 0, 20, 20]);
                ctx.fill();
                ctx.fillStyle = "#5d2e0a";
                ctx.fillRect(basket.x - 5, basket.y, basket.width + 10, 10);

                // Crear y actualizar items
                if (Math.random() < 0.02 + (baseSpeed * 0.005)) createItem();

                items.forEach((item, index) => {
                    item.y += item.speed;
                    ctx.font = `${item.size}px Arial`;
                    ctx.fillText(item.symbol, item.x, item.y);

                    // Detecci√≥n de colisi√≥n
                    if (item.y + item.size/2 > basket.y && item.y < basket.y + basket.height &&
                        item.x + item.size > basket.x && item.x < basket.x + basket.width) {
                        
                        if (item.type === "good") {
                            score += item.value;
                        } else {
                            lives--;
                            triggerExplosion();
                            items = []; // Limpia objetos para dar respiro
                        }
                        updateUI();
                        items.splice(index, 1);

                        if (lives <= 0) {
                            gameActive = false;
                            alert(`GAME OVER\nTotal: ${score} puntos.`);
                            menu.style.display = "block";
                            uiLayer.style.display = "none";
                        }
                    }
                    if (item.y > canvas.height) items.splice(index, 1);
                });
            }

            requestAnimationFrame(draw);
        }
    </script>
</body>
</html>